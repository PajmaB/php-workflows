name: Reusable PHP Login Workflow (Basic)

on:
  workflow_call:
    inputs:
      php_version:
        required: false
        type: string
        default: '8.1'

jobs:
  test-login:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do repositório chamador
        uses: actions/checkout@v3

      - name: Configurar PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ inputs.php_version }}

      - name: Executar teste básico de login (index.php)
        run: |
          php -r 'session_start();
          $_POST["username"]="admin";
          $_POST["password"]="novaSenha";
          include "index.php";
          if (!($_SESSION["loggedin"] ?? false)) {
            echo "LOGIN_FAILED\n";
            exit(1);
          }
          if (($_SESSION["username"] ?? "") !== "admin") {
            echo "USERNAME_MISMATCH\n";
            exit(1);
          }
          echo "LOGIN_OK\n";'
